import{_ as t}from"./plugin-vue_export-helper.21dcd24c.js";import{r as c,o as a,c as l,a as e,b as s,e as d,d as i}from"./app.610296d2.js";const r={},o=d(`<p>\u5927\u5BB6\u597D\uFF0C\u6211\u662F\u4E8C\u54E5\u5440\u3002</p><p>\u6211\u4EEC\u516C\u53F8\u505A\u4E86\u4E00\u4E2A\u5C0F\u7834\u7AD9\uFF0C\u73B0\u5728\u8981\u5B9E\u73B0\u4E00\u4E2A\u7AD9\u5185\u4FE1 web \u6D88\u606F\u63A8\u9001\u7684\u529F\u80FD\uFF0C\u5BF9\uFF0C\u5C31\u662F\u4E0B\u56FE\u8FD9\u4E2A\u5C0F\u7EA2\u70B9\uFF0C\u4E00\u4E2A\u5F88\u5E38\u7528\u7684\u529F\u80FD\u3002\u8001\u677F\u9650\u65F6\u4E09\u5929\u5185\u5B8C\u6210\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-7dad1821-bd37-4e47-80fc-b09db54c1a71.jpg" alt=""></p><p>\u6211\u6574\u7406\u4E86\u51E0\u79CD\u65B9\u6848\uFF0C\u5E76\u7B80\u5355\u505A\u4E86\u5B9E\u73B0\uFF0C\u7B49\u4E09\u5929\u540E\u8BA9\u8001\u677F\u8FC7\u76EE\uFF0C\u5927\u5BB6\u4F19\u5148\u770B\u770B\u8FD9\u51E0\u4E2A\u65B9\u6848\u5982\u4F55\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-6509c4d3-7c5f-4b6e-95e9-4e9482133d21.jpg" alt=""></p><h2 id="\u4EC0\u4E48\u662F\u6D88\u606F\u63A8\u9001-push" tabindex="-1"><a class="header-anchor" href="#\u4EC0\u4E48\u662F\u6D88\u606F\u63A8\u9001-push" aria-hidden="true">#</a> \u4EC0\u4E48\u662F\u6D88\u606F\u63A8\u9001\uFF08push\uFF09</h2><p>\u63A8\u9001\u7684\u573A\u666F\u6BD4\u8F83\u591A\uFF0C\u6BD4\u5982\u6709\u4EBA\u5173\u6CE8\u6211\u7684\u516C\u4F17\u53F7\uFF0C\u8FD9\u65F6\u6211\u5C31\u4F1A\u6536\u5230\u4E00\u6761\u63A8\u9001\u6D88\u606F\uFF0C\u4EE5\u6B64\u6765\u5438\u5F15\u6211\u70B9\u51FB\u6253\u5F00\u5E94\u7528\u3002</p><p>\u6D88\u606F\u63A8\u9001(<code>push</code>)\u901A\u5E38\u662F\u6307\u7F51\u7AD9\u7684\u8FD0\u8425\u5DE5\u4F5C\u7B49\u4EBA\u5458\uFF0C\u901A\u8FC7\u67D0\u79CD\u5DE5\u5177\u5BF9\u7528\u6237\u5F53\u524D\u7F51\u9875\u6216\u79FB\u52A8\u8BBE\u5907 APP \u8FDB\u884C\u7684\u4E3B\u52A8\u6D88\u606F\u63A8\u9001\u3002</p><p>\u6D88\u606F\u63A8\u9001\u4E00\u822C\u53C8\u5206\u4E3A<code>web\u7AEF\u6D88\u606F\u63A8\u9001</code>\u548C<code>\u79FB\u52A8\u7AEF\u6D88\u606F\u63A8\u9001</code>\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-45d8c9ae-666f-468b-b8c5-2a04a1762a4e.jpg" alt=""></p><p>\u4E0A\u8FB9\u7684\u8FD9\u79CD\u5C5E\u4E8E\u79FB\u52A8\u7AEF\u6D88\u606F\u63A8\u9001\uFF0Cweb \u7AEF\u6D88\u606F\u63A8\u9001\u5E38\u89C1\u7684\u8BF8\u5982\u7AD9\u5185\u4FE1\u3001\u672A\u8BFB\u90AE\u4EF6\u6570\u91CF\u3001\u76D1\u63A7\u62A5\u8B66\u6570\u91CF\u7B49\uFF0C\u5E94\u7528\u7684\u4E5F\u975E\u5E38\u5E7F\u6CDB\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-f6ca6bd4-63d8-4081-9348-ca48a68aaf09.jpg" alt=""></p><p>\u5728\u5177\u4F53\u5B9E\u73B0\u4E4B\u524D\uFF0C\u54B1\u4EEC\u518D\u6765\u5206\u6790\u4E00\u4E0B\u524D\u8FB9\u7684\u9700\u6C42\uFF0C\u5176\u5B9E\u529F\u80FD\u5F88\u7B80\u5355\uFF0C\u53EA\u8981\u89E6\u53D1\u67D0\u4E2A\u4E8B\u4EF6\uFF08\u4E3B\u52A8\u5206\u4EAB\u4E86\u8D44\u6E90\u6216\u8005\u540E\u53F0\u4E3B\u52A8\u63A8\u9001\u6D88\u606F\uFF09\uFF0Cweb \u9875\u9762\u7684\u901A\u77E5\u5C0F\u7EA2\u70B9\u5C31\u4F1A\u5B9E\u65F6\u7684<code>+1</code>\u5C31\u53EF\u4EE5\u4E86\u3002</p><p>\u901A\u5E38\u5728\u670D\u52A1\u7AEF\u4F1A\u6709\u82E5\u5E72\u5F20\u6D88\u606F\u63A8\u9001\u8868\uFF0C\u7528\u6765\u8BB0\u5F55\u7528\u6237\u89E6\u53D1\u4E0D\u540C\u4E8B\u4EF6\u6240\u63A8\u9001\u4E0D\u540C\u7C7B\u578B\u7684\u6D88\u606F\uFF0C\u524D\u7AEF\u4E3B\u52A8\u67E5\u8BE2\uFF08\u62C9\uFF09\u6216\u8005\u88AB\u52A8\u63A5\u6536\uFF08\u63A8\uFF09\u7528\u6237\u6240\u6709\u672A\u8BFB\u7684\u6D88\u606F\u6570\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-d73b5ed2-78e4-48f4-a5b0-edc2a078be8f.jpg" alt=""></p><p>\u6D88\u606F\u63A8\u9001\u65E0\u975E\u662F\u63A8\uFF08<code>push</code>\uFF09\u548C\u62C9\uFF08<code>pull</code>\uFF09\u4E24\u79CD\u5F62\u5F0F\uFF0C\u4E0B\u8FB9\u6211\u4EEC\u9010\u4E2A\u4E86\u89E3\u4E0B\u3002</p><h2 id="\u77ED\u8F6E\u8BE2" tabindex="-1"><a class="header-anchor" href="#\u77ED\u8F6E\u8BE2" aria-hidden="true">#</a> \u77ED\u8F6E\u8BE2</h2><p>\u8F6E\u8BE2(<code>polling</code>)\u5E94\u8BE5\u662F\u5B9E\u73B0\u6D88\u606F\u63A8\u9001\u65B9\u6848\u4E2D\u6700\u7B80\u5355\u7684\u4E00\u79CD\uFF0C\u8FD9\u91CC\u6211\u4EEC\u6682\u4E14\u5C06\u8F6E\u8BE2\u5206\u4E3A<code>\u77ED\u8F6E\u8BE2</code>\u548C<code>\u957F\u8F6E\u8BE2</code>\u3002</p><p>\u77ED\u8F6E\u8BE2\u5F88\u597D\u7406\u89E3\uFF0C\u6307\u5B9A\u7684\u65F6\u95F4\u95F4\u9694\uFF0C\u7531\u6D4F\u89C8\u5668\u5411\u670D\u52A1\u5668\u53D1\u51FA<code>HTTP</code>\u8BF7\u6C42\uFF0C\u670D\u52A1\u5668\u5B9E\u65F6\u8FD4\u56DE\u672A\u8BFB\u6D88\u606F\u6570\u636E\u7ED9\u5BA2\u6237\u7AEF\uFF0C\u6D4F\u89C8\u5668\u518D\u505A\u6E32\u67D3\u663E\u793A\u3002</p><p>\u4E00\u4E2A\u7B80\u5355\u7684 JS \u5B9A\u65F6\u5668\u5C31\u53EF\u4EE5\u641E\u5B9A\uFF0C\u6BCF\u79D2\u949F\u8BF7\u6C42\u4E00\u6B21\u672A\u8BFB\u6D88\u606F\u6570\u63A5\u53E3\uFF0C\u8FD4\u56DE\u7684\u6570\u636E\u5C55\u793A\u5373\u53EF\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>setInterval(() =&gt; {
  // \u65B9\u6CD5\u8BF7\u6C42
  messageCount().then((res) =&gt; {
      if (res.code === 200) {
          this.messageCount = res.data
      }
  })
}, 1000);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6548\u679C\u8FD8\u662F\u53EF\u4EE5\u7684\uFF0C\u77ED\u8F6E\u8BE2\u5B9E\u73B0\u56FA\u7136\u7B80\u5355\uFF0C\u7F3A\u70B9\u4E5F\u662F\u663E\u800C\u6613\u89C1\uFF0C\u7531\u4E8E\u63A8\u9001\u6570\u636E\u5E76\u4E0D\u4F1A\u9891\u7E41\u53D8\u66F4\uFF0C\u65E0\u8BBA\u540E\u7AEF\u6B64\u65F6\u662F\u5426\u6709\u65B0\u7684\u6D88\u606F\u4EA7\u751F\uFF0C\u5BA2\u6237\u7AEF\u90FD\u4F1A\u8FDB\u884C\u8BF7\u6C42\uFF0C\u52BF\u5FC5\u4F1A\u5BF9\u670D\u52A1\u7AEF\u9020\u6210\u5F88\u5927\u538B\u529B\uFF0C\u6D6A\u8D39\u5E26\u5BBD\u548C\u670D\u52A1\u5668\u8D44\u6E90\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-c78a59e3-cb09-47be-a50d-d8125c7b6f7a.jpg" alt=""></p><h2 id="\u957F\u8F6E\u8BE2" tabindex="-1"><a class="header-anchor" href="#\u957F\u8F6E\u8BE2" aria-hidden="true">#</a> \u957F\u8F6E\u8BE2</h2><p>\u957F\u8F6E\u8BE2\u662F\u5BF9\u4E0A\u8FB9\u77ED\u8F6E\u8BE2\u7684\u4E00\u79CD\u6539\u8FDB\u7248\u672C\uFF0C\u5728\u5C3D\u53EF\u80FD\u51CF\u5C11\u5BF9\u670D\u52A1\u5668\u8D44\u6E90\u6D6A\u8D39\u7684\u540C\u65F6\uFF0C\u4FDD\u8BC1\u6D88\u606F\u7684\u76F8\u5BF9\u5B9E\u65F6\u6027\u3002\u957F\u8F6E\u8BE2\u5728\u4E2D\u95F4\u4EF6\u4E2D\u5E94\u7528\u7684\u5F88\u5E7F\u6CDB\uFF0C\u6BD4\u5982<code>Nacos</code>\u548C<code>apollo</code>\u914D\u7F6E\u4E2D\u5FC3\uFF0C\u6D88\u606F\u961F\u5217<code>kafka</code>\u3001<code>RocketMQ</code>\u4E2D\u90FD\u6709\u7528\u5230\u957F\u8F6E\u8BE2\u3002</p>`,25),v={href:"https://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247494748&idx=1&sn=2cccdbc6269ea01e75012340af1496ef&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},u=i("Nacos \u914D\u7F6E\u4E2D\u5FC3\u4EA4\u4E92\u6A21\u578B\u662F push \u8FD8\u662F pull\uFF1F"),b=i("\u4E00\u6587\u4E2D\u6211\u8BE6\u7EC6\u4ECB\u7ECD\u8FC7"),m=e("code",null,"Nacos",-1),p=i("\u957F\u8F6E\u8BE2\u7684\u5B9E\u73B0\u539F\u7406\uFF0C\u611F\u5174\u8DA3\u7684\u5C0F\u4F19\u4F34\u53EF\u4EE5\u7785\u7785\u3002"),g=d(`<p>\u8FD9\u6B21\u6211\u4F7F\u7528<code>apollo</code>\u914D\u7F6E\u4E2D\u5FC3\u5B9E\u73B0\u957F\u8F6E\u8BE2\u7684\u65B9\u5F0F\uFF0C\u5E94\u7528\u4E86\u4E00\u4E2A\u7C7B<code>DeferredResult</code>\uFF0C\u5B83\u662F\u5728<code>servelet3.0</code>\u540E\u7ECF\u8FC7 Spring \u5C01\u88C5\u63D0\u4F9B\u7684\u4E00\u79CD\u5F02\u6B65\u8BF7\u6C42\u673A\u5236\uFF0C\u76F4\u610F\u5C31\u662F\u5EF6\u8FDF\u7ED3\u679C\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-6fe55cf8-0929-4360-9ebc-baa2fa203a32.jpg" alt=""></p><p><code>DeferredResult</code>\u53EF\u4EE5\u5141\u8BB8\u5BB9\u5668\u7EBF\u7A0B\u5FEB\u901F\u91CA\u653E\u5360\u7528\u7684\u8D44\u6E90\uFF0C\u4E0D\u963B\u585E\u8BF7\u6C42\u7EBF\u7A0B\uFF0C\u4EE5\u6B64\u63A5\u53D7\u66F4\u591A\u7684\u8BF7\u6C42\u63D0\u5347\u7CFB\u7EDF\u7684\u541E\u5410\u91CF\uFF0C\u7136\u540E\u542F\u52A8\u5F02\u6B65\u5DE5\u4F5C\u7EBF\u7A0B\u5904\u7406\u771F\u6B63\u7684\u4E1A\u52A1\u903B\u8F91\uFF0C\u5904\u7406\u5B8C\u6210\u8C03\u7528<code>DeferredResult.setResult(200)</code>\u63D0\u4EA4\u54CD\u5E94\u7ED3\u679C\u3002</p><p>\u4E0B\u8FB9\u6211\u4EEC\u7528\u957F\u8F6E\u8BE2\u6765\u5B9E\u73B0\u6D88\u606F\u63A8\u9001\u3002</p><p>\u56E0\u4E3A\u4E00\u4E2A ID \u53EF\u80FD\u4F1A\u88AB\u591A\u4E2A\u957F\u8F6E\u8BE2\u8BF7\u6C42\u76D1\u542C\uFF0C\u6240\u4EE5\u6211\u91C7\u7528\u4E86<code>guava</code>\u5305\u63D0\u4F9B\u7684<code>Multimap</code>\u7ED3\u6784\u5B58\u653E\u957F\u8F6E\u8BE2\uFF0C\u4E00\u4E2A key \u53EF\u4EE5\u5BF9\u5E94\u591A\u4E2A value\u3002\u4E00\u65E6\u76D1\u542C\u5230 key \u53D1\u751F\u53D8\u5316\uFF0C\u5BF9\u5E94\u7684\u6240\u6709\u957F\u8F6E\u8BE2\u90FD\u4F1A\u54CD\u5E94\u3002\u524D\u7AEF\u5F97\u5230\u975E\u8BF7\u6C42\u8D85\u65F6\u7684\u72B6\u6001\u7801\uFF0C\u77E5\u6653\u6570\u636E\u53D8\u66F4\uFF0C\u4E3B\u52A8\u67E5\u8BE2\u672A\u8BFB\u6D88\u606F\u6570\u63A5\u53E3\uFF0C\u66F4\u65B0\u9875\u9762\u6570\u636E\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Controller
@RequestMapping(&quot;/polling&quot;)
public class PollingController {

    // \u5B58\u653E\u76D1\u542C\u67D0\u4E2AId\u7684\u957F\u8F6E\u8BE2\u96C6\u5408
    // \u7EBF\u7A0B\u540C\u6B65\u7ED3\u6784
    public static Multimap&lt;String, DeferredResult&lt;String&gt;&gt; watchRequests = Multimaps.synchronizedMultimap(HashMultimap.create());

    /**
     * \u8BBE\u7F6E\u76D1\u542C
     */
    @GetMapping(path = &quot;watch/{id}&quot;)
    @ResponseBody
    public DeferredResult&lt;String&gt; watch(@PathVariable String id) {
        // \u5EF6\u8FDF\u5BF9\u8C61\u8BBE\u7F6E\u8D85\u65F6\u65F6\u95F4
        DeferredResult&lt;String&gt; deferredResult = new DeferredResult&lt;&gt;(TIME_OUT);
        // \u5F02\u6B65\u8BF7\u6C42\u5B8C\u6210\u65F6\u79FB\u9664 key\uFF0C\u9632\u6B62\u5185\u5B58\u6EA2\u51FA
        deferredResult.onCompletion(() -&gt; {
            watchRequests.remove(id, deferredResult);
        });
        // \u6CE8\u518C\u957F\u8F6E\u8BE2\u8BF7\u6C42
        watchRequests.put(id, deferredResult);
        return deferredResult;
    }

    /**
     * \u516C\u4F17\u53F7\uFF1A\u7A0B\u5E8F\u5458\u5C0F\u5BCC
     * \u53D8\u66F4\u6570\u636E
     */
    @GetMapping(path = &quot;publish/{id}&quot;)
    @ResponseBody
    public String publish(@PathVariable String id) {
        // \u6570\u636E\u53D8\u66F4 \u53D6\u51FA\u76D1\u542CID\u7684\u6240\u6709\u957F\u8F6E\u8BE2\u8BF7\u6C42\uFF0C\u5E76\u4E00\u4E00\u54CD\u5E94\u5904\u7406
        if (watchRequests.containsKey(id)) {
            Collection&lt;DeferredResult&lt;String&gt;&gt; deferredResults = watchRequests.get(id);
            for (DeferredResult&lt;String&gt; deferredResult : deferredResults) {
                deferredResult.setResult(&quot;\u6211\u66F4\u65B0\u4E86&quot; + new Date());
            }
        }
        return &quot;success&quot;;
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F53\u8BF7\u6C42\u8D85\u8FC7\u8BBE\u7F6E\u7684\u8D85\u65F6\u65F6\u95F4\uFF0C\u4F1A\u629B\u51FA<code>AsyncRequestTimeoutException</code>\u5F02\u5E38\uFF0C\u8FD9\u91CC\u76F4\u63A5\u7528<code>@ControllerAdvice</code>\u5168\u5C40\u6355\u83B7\u7EDF\u4E00\u8FD4\u56DE\u5373\u53EF\uFF0C\u524D\u7AEF\u83B7\u53D6\u7EA6\u5B9A\u597D\u7684\u72B6\u6001\u7801\u540E\u518D\u6B21\u53D1\u8D77\u957F\u8F6E\u8BE2\u8BF7\u6C42\uFF0C\u5982\u6B64\u5F80\u590D\u8C03\u7528\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@ControllerAdvice
public class AsyncRequestTimeoutHandler {

    @ResponseStatus(HttpStatus.NOT_MODIFIED)
    @ResponseBody
    @ExceptionHandler(AsyncRequestTimeoutException.class)
    public String asyncRequestTimeoutHandler(AsyncRequestTimeoutException e) {
        System.out.println(&quot;\u5F02\u6B65\u8BF7\u6C42\u8D85\u65F6&quot;);
        return &quot;304&quot;;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u6765\u6D4B\u8BD5\u4E00\u4E0B\uFF0C\u9996\u5148\u9875\u9762\u53D1\u8D77\u957F\u8F6E\u8BE2\u8BF7\u6C42<code>/polling/watch/10086</code>\u76D1\u542C\u6D88\u606F\u66F4\u53D8\uFF0C\u8BF7\u6C42\u88AB\u6302\u8D77\uFF0C\u4E0D\u53D8\u66F4\u6570\u636E\u76F4\u81F3\u8D85\u65F6\uFF0C\u518D\u6B21\u53D1\u8D77\u4E86\u957F\u8F6E\u8BE2\u8BF7\u6C42\uFF1B\u7D27\u63A5\u7740\u624B\u52A8\u53D8\u66F4\u6570\u636E<code>/polling/publish/10086</code>\uFF0C\u957F\u8F6E\u8BE2\u5F97\u5230\u54CD\u5E94\uFF0C\u524D\u7AEF\u5904\u7406\u4E1A\u52A1\u903B\u8F91\u5B8C\u6210\u540E\u518D\u6B21\u53D1\u8D77\u8BF7\u6C42\uFF0C\u5982\u6B64\u5FAA\u73AF\u5F80\u590D\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-bbcdfce6-7032-4ad2-a04c-f90d7c4dbf2c.jpg" alt=""></p><p>\u957F\u8F6E\u8BE2\u76F8\u6BD4\u4E8E\u77ED\u8F6E\u8BE2\u5728\u6027\u80FD\u4E0A\u63D0\u5347\u4E86\u5F88\u591A\uFF0C\u4F46\u4F9D\u7136\u4F1A\u4EA7\u751F\u8F83\u591A\u7684\u8BF7\u6C42\uFF0C\u8FD9\u662F\u5B83\u7684\u4E00\u70B9\u4E0D\u5B8C\u7F8E\u7684\u5730\u65B9\u3002</p><h2 id="iframe-\u6D41" tabindex="-1"><a class="header-anchor" href="#iframe-\u6D41" aria-hidden="true">#</a> iframe \u6D41</h2><p>iframe \u6D41\u5C31\u662F\u5728\u9875\u9762\u4E2D\u63D2\u5165\u4E00\u4E2A\u9690\u85CF\u7684<code>&lt;iframe&gt;</code>\u6807\u7B7E\uFF0C\u901A\u8FC7\u5728<code>src</code>\u4E2D\u8BF7\u6C42\u6D88\u606F\u6570\u91CF API \u63A5\u53E3\uFF0C\u7531\u6B64\u5728\u670D\u52A1\u7AEF\u548C\u5BA2\u6237\u7AEF\u4E4B\u95F4\u521B\u5EFA\u4E00\u6761\u957F\u8FDE\u63A5\uFF0C\u670D\u52A1\u7AEF\u6301\u7EED\u5411<code>iframe</code>\u4F20\u8F93\u6570\u636E\u3002</p><blockquote><p>\u4F20\u8F93\u7684\u6570\u636E\u901A\u5E38\u662F<code>HTML</code>\u3001\u6216\u662F\u5185\u5D4C\u7684<code>javascript</code>\u811A\u672C\uFF0C\u6765\u8FBE\u5230\u5B9E\u65F6\u66F4\u65B0\u9875\u9762\u7684\u6548\u679C\u3002</p></blockquote><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-360e8778-af64-407c-8dcf-72308d6d1c43.jpg" alt=""></p><p>\u8FD9\u79CD\u65B9\u5F0F\u5B9E\u73B0\u7B80\u5355\uFF0C\u524D\u7AEF\u53EA\u8981\u4E00\u4E2A<code>&lt;iframe&gt;</code>\u6807\u7B7E\u641E\u5B9A\u4E86</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;iframe src=&quot;/iframe/message&quot; style=&quot;display:none&quot;&gt;&lt;/iframe&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u670D\u52A1\u7AEF\u76F4\u63A5\u7EC4\u88C5 html\u3001js \u811A\u672C\u6570\u636E\u5411<code>response</code>\u5199\u5165\u5C31\u884C\u4E86</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Controller
@RequestMapping(&quot;/iframe&quot;)
public class IframeController {
    @GetMapping(path = &quot;message&quot;)
    public void message(HttpServletResponse response) throws IOException, InterruptedException {
        while (true) {
            response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;);
            response.setDateHeader(&quot;Expires&quot;, 0);
            response.setHeader(&quot;Cache-Control&quot;, &quot;no-cache,no-store&quot;);
            response.setStatus(HttpServletResponse.SC_OK);
            response.getWriter().print(&quot; &lt;script type=\\&quot;text/javascript\\&quot;&gt;\\n&quot; +
                    &quot;parent.document.getElementById(&#39;clock&#39;).innerHTML = \\&quot;&quot; + count.get() + &quot;\\&quot;;&quot; +
                    &quot;parent.document.getElementById(&#39;count&#39;).innerHTML = \\&quot;&quot; + count.get() + &quot;\\&quot;;&quot; +
                    &quot;&lt;/script&gt;&quot;);
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F46\u6211\u4E2A\u4EBA\u4E0D\u63A8\u8350\uFF0C\u56E0\u4E3A\u5B83\u5728\u6D4F\u89C8\u5668\u4E0A\u4F1A\u663E\u793A\u8BF7\u6C42\u672A\u52A0\u8F7D\u5B8C\uFF0C\u56FE\u6807\u4F1A\u4E0D\u505C\u65CB\u8F6C\uFF0C\u7B80\u76F4\u662F\u5F3A\u8FEB\u75C7\u6740\u624B\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-b66b0eee-189a-49f0-aae6-31b549543c20.jpg" alt=""></p><h2 id="sse-\u6211\u7684\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#sse-\u6211\u7684\u65B9\u5F0F" aria-hidden="true">#</a> SSE (\u6211\u7684\u65B9\u5F0F)</h2><p>\u5F88\u591A\u4EBA\u53EF\u80FD\u4E0D\u77E5\u9053\uFF0C\u670D\u52A1\u7AEF\u5411\u5BA2\u6237\u7AEF\u63A8\u9001\u6D88\u606F\uFF0C\u5176\u5B9E\u9664\u4E86\u53EF\u4EE5\u7528<code>WebSocket</code>\u8FD9\u79CD\u8033\u719F\u80FD\u8BE6\u7684\u673A\u5236\u5916\uFF0C\u8FD8\u6709\u4E00\u79CD\u670D\u52A1\u5668\u53D1\u9001\u4E8B\u4EF6(<code>Server-sent events</code>)\uFF0C\u7B80\u79F0<code>SSE</code>\u3002</p><p><code>SSE</code>\u5B83\u662F\u57FA\u4E8E<code>HTTP</code>\u534F\u8BAE\u7684\uFF0C\u6211\u4EEC\u77E5\u9053\u4E00\u822C\u610F\u4E49\u4E0A\u7684 HTTP \u534F\u8BAE\u662F\u65E0\u6CD5\u505A\u5230\u670D\u52A1\u7AEF\u4E3B\u52A8\u5411\u5BA2\u6237\u7AEF\u63A8\u9001\u6D88\u606F\u7684\uFF0C\u4F46 SSE \u662F\u4E2A\u4F8B\u5916\uFF0C\u5B83\u53D8\u6362\u4E86\u4E00\u79CD\u601D\u8DEF\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-1668dd05-2600-431d-ac93-20e0ac4022b7.jpg" alt=""></p><p>SSE \u5728\u670D\u52A1\u5668\u548C\u5BA2\u6237\u7AEF\u4E4B\u95F4\u6253\u5F00\u4E00\u4E2A\u5355\u5411\u901A\u9053\uFF0C\u670D\u52A1\u7AEF\u54CD\u5E94\u7684\u4E0D\u518D\u662F\u4E00\u6B21\u6027\u7684\u6570\u636E\u5305\u800C\u662F<code>text/event-stream</code>\u7C7B\u578B\u7684\u6570\u636E\u6D41\u4FE1\u606F\uFF0C\u5728\u6709\u6570\u636E\u53D8\u66F4\u65F6\u4ECE\u670D\u52A1\u5668\u6D41\u5F0F\u4F20\u8F93\u5230\u5BA2\u6237\u7AEF\u3002</p><p>\u6574\u4F53\u7684\u5B9E\u73B0\u601D\u8DEF\u6709\u70B9\u7C7B\u4F3C\u4E8E\u5728\u7EBF\u89C6\u9891\u64AD\u653E\uFF0C\u89C6\u9891\u6D41\u4F1A\u8FDE\u7EED\u4E0D\u65AD\u7684\u63A8\u9001\u5230\u6D4F\u89C8\u5668\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u7406\u89E3\u6210\uFF0C\u5BA2\u6237\u7AEF\u5728\u5B8C\u6210\u4E00\u6B21\u7528\u65F6\u5F88\u957F\uFF08\u7F51\u7EDC\u4E0D\u7545\uFF09\u7684\u4E0B\u8F7D\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-c18f4919-8877-4afa-b20f-700141cae211.jpg" alt=""></p><p><code>SSE</code>\u4E0E<code>WebSocket</code>\u4F5C\u7528\u76F8\u4F3C\uFF0C\u90FD\u53EF\u4EE5\u5EFA\u7ACB\u670D\u52A1\u7AEF\u4E0E\u6D4F\u89C8\u5668\u4E4B\u95F4\u7684\u901A\u4FE1\uFF0C\u5B9E\u73B0\u670D\u52A1\u7AEF\u5411\u5BA2\u6237\u7AEF\u63A8\u9001\u6D88\u606F\uFF0C\u4F46\u8FD8\u662F\u6709\u4E9B\u8BB8\u4E0D\u540C\uFF1A</p><ul><li>SSE \u662F\u57FA\u4E8E HTTP \u534F\u8BAE\u7684\uFF0C\u5B83\u4EEC\u4E0D\u9700\u8981\u7279\u6B8A\u7684\u534F\u8BAE\u6216\u670D\u52A1\u5668\u5B9E\u73B0\u5373\u53EF\u5DE5\u4F5C\uFF1B<code>WebSocket</code>\u9700\u5355\u72EC\u670D\u52A1\u5668\u6765\u5904\u7406\u534F\u8BAE\u3002</li><li>SSE \u5355\u5411\u901A\u4FE1\uFF0C\u53EA\u80FD\u7531\u670D\u52A1\u7AEF\u5411\u5BA2\u6237\u7AEF\u5355\u5411\u901A\u4FE1\uFF1BwebSocket \u5168\u53CC\u5DE5\u901A\u4FE1\uFF0C\u5373\u901A\u4FE1\u7684\u53CC\u65B9\u53EF\u4EE5\u540C\u65F6\u53D1\u9001\u548C\u63A5\u53D7\u4FE1\u606F\u3002</li><li>SSE \u5B9E\u73B0\u7B80\u5355\u5F00\u53D1\u6210\u672C\u4F4E\uFF0C\u65E0\u9700\u5F15\u5165\u5176\u4ED6\u7EC4\u4EF6\uFF1BWebSocket \u4F20\u8F93\u6570\u636E\u9700\u505A\u4E8C\u6B21\u89E3\u6790\uFF0C\u5F00\u53D1\u95E8\u69DB\u9AD8\u4E00\u4E9B\u3002</li><li>SSE \u9ED8\u8BA4\u652F\u6301\u65AD\u7EBF\u91CD\u8FDE\uFF1BWebSocket \u5219\u9700\u8981\u81EA\u5DF1\u5B9E\u73B0\u3002</li><li>SSE \u53EA\u80FD\u4F20\u9001\u6587\u672C\u6D88\u606F\uFF0C\u4E8C\u8FDB\u5236\u6570\u636E\u9700\u8981\u7ECF\u8FC7\u7F16\u7801\u540E\u4F20\u9001\uFF1BWebSocket \u9ED8\u8BA4\u652F\u6301\u4F20\u9001\u4E8C\u8FDB\u5236\u6570\u636E\u3002</li></ul><p><strong>SSE \u4E0E WebSocket \u8BE5\u5982\u4F55\u9009\u62E9\uFF1F</strong></p><blockquote><p>\u6280\u672F\u5E76\u6CA1\u6709\u597D\u574F\u4E4B\u5206\uFF0C\u53EA\u6709\u54EA\u4E2A\u66F4\u5408\u9002</p></blockquote><p>SSE \u597D\u50CF\u4E00\u76F4\u4E0D\u88AB\u5927\u5BB6\u6240\u719F\u77E5\uFF0C\u4E00\u90E8\u5206\u539F\u56E0\u662F\u51FA\u73B0\u4E86 WebSockets\uFF0C\u8FD9\u4E2A\u63D0\u4F9B\u4E86\u66F4\u4E30\u5BCC\u7684\u534F\u8BAE\u6765\u6267\u884C\u53CC\u5411\u3001\u5168\u53CC\u5DE5\u901A\u4FE1\u3002\u5BF9\u4E8E\u6E38\u620F\u3001\u5373\u65F6\u901A\u4FE1\u4EE5\u53CA\u9700\u8981\u53CC\u5411\u8FD1\u4E4E\u5B9E\u65F6\u66F4\u65B0\u7684\u573A\u666F\uFF0C\u62E5\u6709\u53CC\u5411\u901A\u9053\u66F4\u5177\u5438\u5F15\u529B\u3002</p><p>\u4F46\u662F\uFF0C\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\uFF0C\u4E0D\u9700\u8981\u4ECE\u5BA2\u6237\u7AEF\u53D1\u9001\u6570\u636E\u3002\u800C\u4F60\u53EA\u9700\u8981\u4E00\u4E9B\u670D\u52A1\u5668\u64CD\u4F5C\u7684\u66F4\u65B0\u3002\u6BD4\u5982\uFF1A\u7AD9\u5185\u4FE1\u3001\u672A\u8BFB\u6D88\u606F\u6570\u3001\u72B6\u6001\u66F4\u65B0\u3001\u80A1\u7968\u884C\u60C5\u3001\u76D1\u63A7\u6570\u91CF\u7B49\u573A\u666F\uFF0C<code>SEE</code>\u4E0D\u7BA1\u662F\u4ECE\u5B9E\u73B0\u7684\u96BE\u6613\u548C\u6210\u672C\u4E0A\u90FD\u66F4\u52A0\u6709\u4F18\u52BF\u3002\u6B64\u5916\uFF0CSSE \u5177\u6709<code>WebSockets</code>\u5728\u8BBE\u8BA1\u4E0A\u7F3A\u4E4F\u7684\u591A\u79CD\u529F\u80FD\uFF0C\u4F8B\u5982\uFF1A<code>\u81EA\u52A8\u91CD\u65B0\u8FDE\u63A5</code>\u3001<code>\u4E8B\u4EF6ID</code>\u548C<code>\u53D1\u9001\u4EFB\u610F\u4E8B\u4EF6</code>\u7684\u80FD\u529B\u3002</p><p>\u524D\u7AEF\u53EA\u9700\u8FDB\u884C\u4E00\u6B21 HTTP \u8BF7\u6C42\uFF0C\u5E26\u4E0A\u552F\u4E00 ID\uFF0C\u6253\u5F00\u4E8B\u4EF6\u6D41\uFF0C\u76D1\u542C\u670D\u52A1\u7AEF\u63A8\u9001\u7684\u4E8B\u4EF6\u5C31\u53EF\u4EE5\u4E86</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
    let source = null;
    let userId = 7777
    if (window.EventSource) {
        // \u5EFA\u7ACB\u8FDE\u63A5
        source = new EventSource(&#39;http://localhost:7777/sse/sub/&#39;+userId);
        setMessageInnerHTML(&quot;\u8FDE\u63A5\u7528\u6237=&quot; + userId);
        /**
         * \u8FDE\u63A5\u4E00\u65E6\u5EFA\u7ACB\uFF0C\u5C31\u4F1A\u89E6\u53D1open\u4E8B\u4EF6
         * \u53E6\u4E00\u79CD\u5199\u6CD5\uFF1Asource.onopen = function (event) {}
         */
        source.addEventListener(&#39;open&#39;, function (e) {
            setMessageInnerHTML(&quot;\u5EFA\u7ACB\u8FDE\u63A5\u3002\u3002\u3002&quot;);
        }, false);
        /**
         * \u5BA2\u6237\u7AEF\u6536\u5230\u670D\u52A1\u5668\u53D1\u6765\u7684\u6570\u636E
         * \u53E6\u4E00\u79CD\u5199\u6CD5\uFF1Asource.onmessage = function (event) {}
         */
        source.addEventListener(&#39;message&#39;, function (e) {
            setMessageInnerHTML(e.data);
        });
    } else {
        setMessageInnerHTML(&quot;\u4F60\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301SSE&quot;);
    }
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u670D\u52A1\u7AEF\u7684\u5B9E\u73B0\u66F4\u7B80\u5355\uFF0C\u521B\u5EFA\u4E00\u4E2A<code>SseEmitter</code>\u5BF9\u8C61\u653E\u5165<code>sseEmitterMap</code>\u8FDB\u884C\u7BA1\u7406</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>private static Map&lt;String, SseEmitter&gt; sseEmitterMap = new ConcurrentHashMap&lt;&gt;();

/**
 * \u521B\u5EFA\u8FDE\u63A5
 *
 * @date: 2022/7/12 14:51
 * @auther: \u516C\u4F17\u53F7\uFF1A\u7A0B\u5E8F\u5458\u5C0F\u5BCC
 */
public static SseEmitter connect(String userId) {
    try {
        // \u8BBE\u7F6E\u8D85\u65F6\u65F6\u95F4\uFF0C0\u8868\u793A\u4E0D\u8FC7\u671F\u3002\u9ED8\u8BA430\u79D2
        SseEmitter sseEmitter = new SseEmitter(0L);
        // \u6CE8\u518C\u56DE\u8C03
        sseEmitter.onCompletion(completionCallBack(userId));
        sseEmitter.onError(errorCallBack(userId));
        sseEmitter.onTimeout(timeoutCallBack(userId));
        sseEmitterMap.put(userId, sseEmitter);
        count.getAndIncrement();
        return sseEmitter;
    } catch (Exception e) {
        log.info(&quot;\u521B\u5EFA\u65B0\u7684sse\u8FDE\u63A5\u5F02\u5E38\uFF0C\u5F53\u524D\u7528\u6237\uFF1A{}&quot;, userId);
    }
    return null;
}

/**
 * \u7ED9\u6307\u5B9A\u7528\u6237\u53D1\u9001\u6D88\u606F
 *
 * @date: 2022/7/12 14:51
 * @auther: \u516C\u4F17\u53F7\uFF1A\u7A0B\u5E8F\u5458\u5C0F\u5BCC
 */
public static void sendMessage(String userId, String message) {

    if (sseEmitterMap.containsKey(userId)) {
        try {
            sseEmitterMap.get(userId).send(message);
        } catch (IOException e) {
            log.error(&quot;\u7528\u6237[{}]\u63A8\u9001\u5F02\u5E38:{}&quot;, userId, e.getMessage());
            removeUser(userId);
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u6A21\u62DF\u670D\u52A1\u7AEF\u63A8\u9001\u6D88\u606F\uFF0C\u770B\u4E0B\u5BA2\u6237\u7AEF\u6536\u5230\u4E86\u6D88\u606F\uFF0C\u548C\u6211\u4EEC\u9884\u671F\u7684\u6548\u679C\u4E00\u81F4\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-78c18502-2b42-46fe-9414-74ab9017c5d5.jpg" alt=""></p><p><strong>\u6CE8\u610F\uFF1A</strong> SSE \u4E0D\u652F\u6301<code>IE</code>\u6D4F\u89C8\u5668\uFF0C\u5BF9\u5176\u4ED6\u4E3B\u6D41\u6D4F\u89C8\u5668\u517C\u5BB9\u6027\u505A\u7684\u8FD8\u4E0D\u9519\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-0a5ab7ce-1921-414b-8ad1-d7ea4d0b2d55.jpg" alt=""></p><h2 id="mqtt" tabindex="-1"><a class="header-anchor" href="#mqtt" aria-hidden="true">#</a> MQTT</h2><p>\u4EC0\u4E48\u662F MQTT \u534F\u8BAE\uFF1F</p><p><code>MQTT</code> \u5168\u79F0(Message Queue Telemetry Transport)\uFF1A\u4E00\u79CD\u57FA\u4E8E\u53D1\u5E03/\u8BA2\u9605\uFF08<code>publish</code>/<code>subscribe</code>\uFF09\u6A21\u5F0F\u7684<code>\u8F7B\u91CF\u7EA7</code>\u901A\u8BAF\u534F\u8BAE\uFF0C\u901A\u8FC7\u8BA2\u9605\u76F8\u5E94\u7684\u4E3B\u9898\u6765\u83B7\u53D6\u6D88\u606F\uFF0C\u662F\u7269\u8054\u7F51\uFF08<code>Internet of Thing</code>\uFF09\u4E2D\u7684\u4E00\u4E2A\u6807\u51C6\u4F20\u8F93\u534F\u8BAE\u3002</p><p>\u8BE5\u534F\u8BAE\u5C06\u6D88\u606F\u7684\u53D1\u5E03\u8005\uFF08<code>publisher</code>\uFF09\u4E0E\u8BA2\u9605\u8005\uFF08<code>subscriber</code>\uFF09\u8FDB\u884C\u5206\u79BB\uFF0C\u56E0\u6B64\u53EF\u4EE5\u5728\u4E0D\u53EF\u9760\u7684\u7F51\u7EDC\u73AF\u5883\u4E2D\uFF0C\u4E3A\u8FDC\u7A0B\u8FDE\u63A5\u7684\u8BBE\u5907\u63D0\u4F9B\u53EF\u9760\u7684\u6D88\u606F\u670D\u52A1\uFF0C\u4F7F\u7528\u65B9\u5F0F\u4E0E\u4F20\u7EDF\u7684 MQ \u6709\u70B9\u7C7B\u4F3C\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-5524743a-1f9f-4cde-9f0a-e30312f368b8.jpg" alt=""></p><p><code>TCP</code>\u534F\u8BAE\u4F4D\u4E8E\u4F20\u8F93\u5C42\uFF0C<code>MQTT</code> \u534F\u8BAE\u4F4D\u4E8E\u5E94\u7528\u5C42\uFF0C<code>MQTT</code> \u534F\u8BAE\u6784\u5EFA\u4E8E<code>TCP/IP</code>\u534F\u8BAE\u4E0A\uFF0C\u4E5F\u5C31\u662F\u8BF4\u53EA\u8981\u652F\u6301<code>TCP/IP</code>\u534F\u8BAE\u6808\u7684\u5730\u65B9\uFF0C\u90FD\u53EF\u4EE5\u4F7F\u7528<code>MQTT</code>\u534F\u8BAE\u3002</p><p>\u4E3A\u4EC0\u4E48\u8981\u7528 MQTT \u534F\u8BAE\uFF1F</p><p><code>MQTT</code>\u534F\u8BAE\u4E3A\u4EC0\u4E48\u5728\u7269\u8054\u7F51\uFF08IOT\uFF09\u4E2D\u5982\u6B64\u53D7\u504F\u7231\uFF1F\u800C\u4E0D\u662F\u5176\u5B83\u534F\u8BAE\uFF0C\u6BD4\u5982\u6211\u4EEC\u66F4\u4E3A\u719F\u6089\u7684 <code>HTTP</code>\u534F\u8BAE\u5462\uFF1F</p><ul><li>\u9996\u5148<code>HTTP</code>\u534F\u8BAE\u5B83\u662F\u4E00\u79CD\u540C\u6B65\u534F\u8BAE\uFF0C\u5BA2\u6237\u7AEF\u8BF7\u6C42\u540E\u9700\u8981\u7B49\u5F85\u670D\u52A1\u5668\u7684\u54CD\u5E94\u3002\u800C\u5728\u7269\u8054\u7F51\uFF08IOT\uFF09\u73AF\u5883\u4E2D\uFF0C\u8BBE\u5907\u4F1A\u5F88\u53D7\u5236\u4E8E\u73AF\u5883\u7684\u5F71\u54CD\uFF0C\u6BD4\u5982\u5E26\u5BBD\u4F4E\u3001\u7F51\u7EDC\u5EF6\u8FDF\u9AD8\u3001\u7F51\u7EDC\u901A\u4FE1\u4E0D\u7A33\u5B9A\u7B49\uFF0C\u663E\u7136\u5F02\u6B65\u6D88\u606F\u534F\u8BAE\u66F4\u4E3A\u9002\u5408<code>IOT</code>\u5E94\u7528\u7A0B\u5E8F\u3002</li><li><code>HTTP</code>\u662F\u5355\u5411\u7684\uFF0C\u5982\u679C\u8981\u83B7\u53D6\u6D88\u606F\u5BA2\u6237\u7AEF\u5FC5\u987B\u53D1\u8D77\u8FDE\u63A5\uFF0C\u800C\u5728\u7269\u8054\u7F51\uFF08IOT\uFF09\u5E94\u7528\u7A0B\u5E8F\u4E2D\uFF0C\u8BBE\u5907\u6216\u4F20\u611F\u5668\u5F80\u5F80\u90FD\u662F\u5BA2\u6237\u7AEF\uFF0C\u8FD9\u610F\u5473\u7740\u5B83\u4EEC\u65E0\u6CD5\u88AB\u52A8\u5730\u63A5\u6536\u6765\u81EA\u7F51\u7EDC\u7684\u547D\u4EE4\u3002</li><li>\u901A\u5E38\u9700\u8981\u5C06\u4E00\u6761\u547D\u4EE4\u6216\u8005\u6D88\u606F\uFF0C\u53D1\u9001\u5230\u7F51\u7EDC\u4E0A\u7684\u6240\u6709\u8BBE\u5907\u4E0A\u3002<code>HTTP</code>\u8981\u5B9E\u73B0\u8FD9\u6837\u7684\u529F\u80FD\u4E0D\u4F46\u5F88\u56F0\u96BE\uFF0C\u800C\u4E14\u6210\u672C\u6781\u9AD8\u3002</li></ul><p>\u5177\u4F53\u7684 MQTT \u534F\u8BAE\u4ECB\u7ECD\u548C\u5B9E\u8DF5\uFF0C\u8FD9\u91CC\u6211\u5C31\u4E0D\u518D\u8D58\u8FF0\u4E86\uFF0C\u5927\u5BB6\u53EF\u4EE5\u53C2\u8003\u6211\u4E4B\u524D\u7684\u4E24\u7BC7\u6587\u7AE0\uFF0C\u91CC\u8FB9\u5199\u7684\u4E5F\u90FD\u5F88\u8BE6\u7EC6\u4E86\u3002</p><p>MQTT \u534F\u8BAE\u7684\u4ECB\u7ECD</p>`,53),h={href:"https://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247486353&idx=1&sn=02371acc8048cb15f29285f0505c4958&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},x=i("\u6211\u4E5F\u6CA1\u60F3\u5230 springboot + rabbitmq \u505A\u667A\u80FD\u5BB6\u5C45\uFF0C\u4F1A\u8FD9\u4E48\u7B80\u5355"),f=e("p",null,"MQTT \u5B9E\u73B0\u6D88\u606F\u63A8\u9001",-1),w={href:"https://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247487818&idx=1&sn=19393de4304e1ddd3179d0e45ec16cd7&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},S=i("\u672A\u8BFB\u6D88\u606F\uFF08\u5C0F\u7EA2\u70B9\uFF09\uFF0C\u524D\u7AEF \u4E0E RabbitMQ \u5B9E\u65F6\u6D88\u606F\u63A8\u9001\u5B9E\u8DF5\uFF0C\u8D3C\u7B80\u5355~"),q=d(`<h2 id="websocket" tabindex="-1"><a class="header-anchor" href="#websocket" aria-hidden="true">#</a> Websocket</h2><p><code>websocket</code>\u5E94\u8BE5\u662F\u5927\u5BB6\u90FD\u6BD4\u8F83\u719F\u6089\u7684\u4E00\u79CD\u5B9E\u73B0\u6D88\u606F\u63A8\u9001\u7684\u65B9\u5F0F\uFF0C\u4E0A\u8FB9\u6211\u4EEC\u5728\u8BB2 SSE \u7684\u65F6\u5019\u4E5F\u548C websocket \u8FDB\u884C\u8FC7\u6BD4\u8F83\u3002</p><p>WebSocket \u662F\u4E00\u79CD\u5728<code>TCP</code>\u8FDE\u63A5\u4E0A\u8FDB\u884C\u5168\u53CC\u5DE5\u901A\u4FE1\u7684\u534F\u8BAE\uFF0C\u5EFA\u7ACB\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u5668\u4E4B\u95F4\u7684\u901A\u4FE1\u6E20\u9053\u3002\u6D4F\u89C8\u5668\u548C\u670D\u52A1\u5668\u4EC5\u9700\u4E00\u6B21\u63E1\u624B\uFF0C\u4E24\u8005\u4E4B\u95F4\u5C31\u76F4\u63A5\u53EF\u4EE5\u521B\u5EFA\u6301\u4E45\u6027\u7684\u8FDE\u63A5\uFF0C\u5E76\u8FDB\u884C\u53CC\u5411\u6570\u636E\u4F20\u8F93\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-5c924827-2ada-4e25-bc89-a67b746b2ae8.jpg" alt=""></p><p>springboot \u6574\u5408 websocket\uFF0C\u5148\u5F15\u5165<code>websocket</code>\u76F8\u5173\u7684\u5DE5\u5177\u5305\uFF0C\u548C SSE \u76F8\u6BD4\u989D\u5916\u7684\u5F00\u53D1\u6210\u672C\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;!-- \u5F15\u5165websocket --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u670D\u52A1\u7AEF\u4F7F\u7528<code>@ServerEndpoint</code>\u6CE8\u89E3\u6807\u6CE8\u5F53\u524D\u7C7B\u4E3A\u4E00\u4E2A websocket \u670D\u52A1\u5668\uFF0C\u5BA2\u6237\u7AEF\u53EF\u4EE5\u901A\u8FC7<code>ws://localhost:7777/webSocket/10086</code>\u6765\u8FDE\u63A5\u5230 WebSocket \u670D\u52A1\u5668\u7AEF\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Component
@Slf4j
@ServerEndpoint(&quot;/websocket/{userId}&quot;)
public class WebSocketServer {
    //\u4E0E\u67D0\u4E2A\u5BA2\u6237\u7AEF\u7684\u8FDE\u63A5\u4F1A\u8BDD\uFF0C\u9700\u8981\u901A\u8FC7\u5B83\u6765\u7ED9\u5BA2\u6237\u7AEF\u53D1\u9001\u6570\u636E
    private Session session;
    private static final CopyOnWriteArraySet&lt;WebSocketServer&gt; webSockets = new CopyOnWriteArraySet&lt;&gt;();
    // \u7528\u6765\u5B58\u5728\u7EBF\u8FDE\u63A5\u6570
    private static final Map&lt;String, Session&gt; sessionPool = new HashMap&lt;String, Session&gt;();
    /**
     * \u516C\u4F17\u53F7\uFF1A\u7A0B\u5E8F\u5458\u5C0F\u5BCC
     * \u94FE\u63A5\u6210\u529F\u8C03\u7528\u7684\u65B9\u6CD5
     */
    @OnOpen
    public void onOpen(Session session, @PathParam(value = &quot;userId&quot;) String userId) {
        try {
            this.session = session;
            webSockets.add(this);
            sessionPool.put(userId, session);
            log.info(&quot;websocket\u6D88\u606F: \u6709\u65B0\u7684\u8FDE\u63A5\uFF0C\u603B\u6570\u4E3A:&quot; + webSockets.size());
        } catch (Exception e) {
        }
    }
    /**
     * \u6536\u5230\u5BA2\u6237\u7AEF\u6D88\u606F\u540E\u8C03\u7528\u7684\u65B9\u6CD5
     */
    @OnMessage
    public void onMessage(String message) {
        log.info(&quot;websocket\u6D88\u606F: \u6536\u5230\u5BA2\u6237\u7AEF\u6D88\u606F:&quot; + message);
    }
    /**
     * \u6B64\u4E3A\u5355\u70B9\u6D88\u606F
     */
    public void sendOneMessage(String userId, String message) {
        Session session = sessionPool.get(userId);
        if (session != null &amp;&amp; session.isOpen()) {
            try {
                log.info(&quot;websocket\u6D88: \u5355\u70B9\u6D88\u606F:&quot; + message);
                session.getAsyncRemote().sendText(message);
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u524D\u7AEF\u521D\u59CB\u5316\u6253\u5F00 WebSocket \u8FDE\u63A5\uFF0C\u5E76\u76D1\u542C\u8FDE\u63A5\u72B6\u6001\uFF0C\u63A5\u6536\u670D\u52A1\u7AEF\u6570\u636E\u6216\u5411\u670D\u52A1\u7AEF\u53D1\u9001\u6570\u636E\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;script&gt;
    var ws = new WebSocket(&#39;ws://localhost:7777/webSocket/10086&#39;);
    // \u83B7\u53D6\u8FDE\u63A5\u72B6\u6001
    console.log(&#39;ws\u8FDE\u63A5\u72B6\u6001\uFF1A&#39; + ws.readyState);
    //\u76D1\u542C\u662F\u5426\u8FDE\u63A5\u6210\u529F
    ws.onopen = function () {
        console.log(&#39;ws\u8FDE\u63A5\u72B6\u6001\uFF1A&#39; + ws.readyState);
        //\u8FDE\u63A5\u6210\u529F\u5219\u53D1\u9001\u4E00\u4E2A\u6570\u636E
        ws.send(&#39;test1&#39;);
    }
    // \u63A5\u542C\u670D\u52A1\u5668\u53D1\u56DE\u7684\u4FE1\u606F\u5E76\u5904\u7406\u5C55\u793A
    ws.onmessage = function (data) {
        console.log(&#39;\u63A5\u6536\u5230\u6765\u81EA\u670D\u52A1\u5668\u7684\u6D88\u606F\uFF1A&#39;);
        console.log(data);
        //\u5B8C\u6210\u901A\u4FE1\u540E\u5173\u95EDWebSocket\u8FDE\u63A5
        ws.close();
    }
    // \u76D1\u542C\u8FDE\u63A5\u5173\u95ED\u4E8B\u4EF6
    ws.onclose = function () {
        // \u76D1\u542C\u6574\u4E2A\u8FC7\u7A0B\u4E2Dwebsocket\u7684\u72B6\u6001
        console.log(&#39;ws\u8FDE\u63A5\u72B6\u6001\uFF1A&#39; + ws.readyState);
    }
    // \u76D1\u542C\u5E76\u5904\u7406error\u4E8B\u4EF6
    ws.onerror = function (error) {
        console.log(error);
    }
    function sendMessage() {
        var content = $(&quot;#message&quot;).val();
        $.ajax({
            url: &#39;/socket/publish?userId=10086&amp;message=&#39; + content,
            type: &#39;GET&#39;,
            data: { &quot;id&quot;: &quot;7777&quot;, &quot;content&quot;: content },
            success: function (data) {
                console.log(data)
            }
        })
    }
&lt;/script&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9875\u9762\u521D\u59CB\u5316\u5EFA\u7ACB websocket \u8FDE\u63A5\uFF0C\u4E4B\u540E\u5C31\u53EF\u4EE5\u8FDB\u884C\u53CC\u5411\u901A\u4FE1\u4E86\uFF0C\u6548\u679C\u8FD8\u4E0D\u9519</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-7cdef2ca-add8-4ef1-be3c-3acab7e45f72.jpg" alt=""></p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-9a99bdb6-6329-4372-8eb9-59bc8d4be64f.jpg" alt=""></p><h2 id="\u81EA\u5B9A\u4E49\u63A8\u9001" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49\u63A8\u9001" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49\u63A8\u9001</h2><p>\u4E0A\u8FB9\u6211\u4EEC\u7ED9\u6211\u51FA\u4E86 6 \u79CD\u65B9\u6848\u7684\u539F\u7406\u548C\u4EE3\u7801\u5B9E\u73B0\uFF0C\u4F46\u5728\u5B9E\u9645\u4E1A\u52A1\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u4E0D\u80FD\u76F2\u76EE\u7684\u76F4\u63A5\u62FF\u8FC7\u6765\u7528\uFF0C\u8FD8\u662F\u8981\u7ED3\u5408\u81EA\u8EAB\u7CFB\u7EDF\u4E1A\u52A1\u7684\u7279\u70B9\u548C\u5B9E\u9645\u573A\u666F\u6765\u9009\u62E9\u5408\u9002\u7684\u65B9\u6848\u3002</p><p>\u63A8\u9001\u6700\u76F4\u63A5\u7684\u65B9\u5F0F\u5C31\u662F\u4F7F\u7528\u7B2C\u4E09\u63A8\u9001\u5E73\u53F0\uFF0C\u6BD5\u7ADF<strong>\u94B1\u80FD\u89E3\u51B3\u7684\u9700\u6C42\u90FD\u4E0D\u662F\u95EE\u9898</strong>\uFF0C\u65E0\u9700\u590D\u6742\u7684\u5F00\u53D1\u8FD0\u7EF4\uFF0C\u76F4\u63A5\u53EF\u4EE5\u4F7F\u7528\uFF0C\u7701\u65F6\u3001\u7701\u529B\u3001\u7701\u5FC3\uFF0C\u50CF goEasy\u3001\u6781\u5149\u63A8\u9001\u90FD\u662F\u5F88\u4E0D\u9519\u7684\u4E09\u65B9\u670D\u52A1\u5546\u3002</p><p>\u4E00\u822C\u5927\u578B\u516C\u53F8\u90FD\u6709\u81EA\u7814\u7684\u6D88\u606F\u63A8\u9001\u5E73\u53F0\uFF0C\u50CF\u6211\u4EEC\u672C\u6B21\u5B9E\u73B0\u7684 web \u7AD9\u5185\u4FE1\u53EA\u662F\u5E73\u53F0\u4E0A\u7684\u4E00\u4E2A\u89E6\u70B9\u800C\u5DF2\uFF0C\u77ED\u4FE1\u3001\u90AE\u4EF6\u3001\u5FAE\u4FE1\u516C\u4F17\u53F7\u3001\u5C0F\u7A0B\u5E8F\u51E1\u662F\u53EF\u4EE5\u89E6\u8FBE\u5230\u7528\u6237\u7684\u6E20\u9053\u90FD\u53EF\u4EE5\u63A5\u5165\u8FDB\u6765\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-b4a464a7-b308-498e-81f9-3418f33c396a.jpg" alt=""></p><p>\u6D88\u606F\u63A8\u9001\u7CFB\u7EDF\u5185\u90E8\u662F\u76F8\u5F53\u590D\u6742\u7684\uFF0C\u8BF8\u5982\u6D88\u606F\u5185\u5BB9\u7684\u7EF4\u62A4\u5BA1\u6838\u3001\u5708\u5B9A\u63A8\u9001\u4EBA\u7FA4\u3001\u89E6\u8FBE\u8FC7\u6EE4\u62E6\u622A\uFF08\u63A8\u9001\u7684\u89C4\u5219\u9891\u6B21\u3001\u65F6\u6BB5\u3001\u6570\u91CF\u3001\u9ED1\u767D\u540D\u5355\u3001\u5173\u952E\u8BCD\u7B49\u7B49\uFF09\u3001\u63A8\u9001\u5931\u8D25\u8865\u507F\u975E\u5E38\u591A\u7684\u6A21\u5757\uFF0C\u6280\u672F\u4E0A\u6D89\u53CA\u5230\u5927\u6570\u636E\u91CF\u3001\u9AD8\u5E76\u53D1\u7684\u573A\u666F\u4E5F\u5F88\u591A\u3002\u6240\u4EE5\u6211\u4EEC\u4ECA\u5929\u7684\u5B9E\u73B0\u65B9\u5F0F\u5728\u8FD9\u4E2A\u5E9E\u5927\u7684\u7CFB\u7EDF\u9762\u524D\u53EA\u662F\u5C0F\u6253\u5C0F\u95F9\u3002</p><h3 id="github-\u5730\u5740" tabindex="-1"><a class="header-anchor" href="#github-\u5730\u5740" aria-hidden="true">#</a> Github \u5730\u5740</h3><p>\u6587\u4E2D\u6240\u63D0\u5230\u7684\u6848\u4F8B\u6211\u90FD\u4E00\u4E00\u7684\u505A\u4E86\u5B9E\u73B0\uFF0C\u6574\u7406\u653E\u5728\u4E86<code>Github</code>\u4E0A\uFF0C\u89C9\u5F97\u6709\u7528\u5C31 <strong>Star</strong> \u4E00\u4E0B\u5427\uFF01</p><blockquote><p>\u4F20\u9001\u95E8\uFF1Ahttps://github.com/chengxy-nds/Springboot-Notebook/tree/master/springboot-realtime-data</p></blockquote>`,22),T=i("\u8F6C\u8F7D\u94FE\u63A5\uFF1A"),k={href:"https://mp.weixin.qq.com/s/xQV81HiD8hkzx2wMc3ZT7A",target:"_blank",rel:"noopener noreferrer"},E=i("https://mp.weixin.qq.com/s/xQV81HiD8hkzx2wMc3ZT7A"),_=i("\uFF0C\u51FA\u5904\uFF1A\u7A0B\u5E8F\u5458\u5C0F\u5BCC\uFF0C\u6574\u7406\uFF1A\u6C89\u9ED8\u738B\u4E8C");function j(y,M){const n=c("ExternalLinkIcon");return a(),l("div",null,[o,e("p",null,[e("a",v,[u,s(n)]),b,m,p]),g,e("p",null,[e("a",h,[x,s(n)])]),f,e("p",null,[e("a",w,[S,s(n)])]),q,e("blockquote",null,[e("p",null,[T,e("a",k,[E,s(n)]),_])])])}var H=t(r,[["render",j],["__file","woycsxwebssxxtsdfac.html.vue"]]);export{H as default};
