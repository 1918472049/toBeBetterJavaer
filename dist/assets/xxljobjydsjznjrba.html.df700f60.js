import{_ as e}from"./plugin-vue_export-helper.21dcd24c.js";import{o as n,c as i,e as s}from"./app.c8e9fe1d.js";const l={},r=s(`<hr><p>\u6587\u7AE0\u6765\u6E90\uFF1Ahttps://c1n.cn/N8Mln\u200D\u200D\u200D\u200D\u200D\u200D</p><p><strong>\u76EE\u5F55</strong></p><ul><li>\u901A\u4FE1\u5E95\u5C42\u4ECB\u7ECD</li><li>\u901A\u4FE1\u6574\u4F53\u6D41\u7A0B</li><li>\u60CA\u8273\u7684\u8BBE\u8BA1</li></ul><p><strong>\u901A\u4FE1\u5E95\u5C42\u4ECB\u7ECD</strong></p><p>xxl-job \u4F7F\u7528 netty http \u7684\u65B9\u5F0F\u8FDB\u884C\u901A\u4FE1\uFF0C\u867D\u7136\u4E5F\u652F\u6301 Mina\uFF0Cjetty\uFF0Cnetty tcp \u7B49\u65B9\u5F0F\uFF0C\u4F46\u662F\u4EE3\u7801\u91CC\u9762\u56FA\u5B9A\u5199\u6B7B\u7684\u662F netty http\u3002</p><p><strong>\u901A\u4FE1\u6574\u4F53\u6D41\u7A0B</strong></p><p>\u6211\u4EE5\u8C03\u5EA6\u5668\u901A\u77E5\u6267\u884C\u5668\u6267\u884C\u4EFB\u52A1\u4E3A\u4F8B\uFF0C\u7ED8\u5236\u7684\u6D3B\u52A8\u56FE\uFF1A</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/1J6IbIcPCLYka9j7GuMHJvuMhrSnQLSbU7cCZku6K0QrNdkF8RUmq49wdrQ3Bf2CUI775d02aGz6WcqYjMHiavw/640?wx_fmt=png" alt=""></p><p><em>\u6D3B\u52A8\u56FE</em></p><p><strong>\u60CA\u8273\u7684\u8BBE\u8BA1</strong></p><p>\u770B\u5B8C\u4E86\u6574\u4E2A\u5904\u7406\u6D41\u7A0B\u4EE3\u7801\uFF0C\u8BBE\u8BA1\u4E0A\u53EF\u4EE5\u8BF4\u72EC\u5177\u5320\u5FC3\uFF0C\u5C06 netty\uFF0C\u591A\u7EBF\u7A0B\u7684\u77E5\u8BC6\u8FD0\u7528\u5F97\u884C\u4E91\u6D41\u6C34\u3002</p><p>\u6211\u73B0\u5728\u5C31\u5C06\u8FD9\u4E9B\u8BBE\u8BA1\u4E0A\u51FA\u5F69\u7684\u70B9\u603B\u7ED3\u5982\u4E0B\uFF1A</p><h4 id="\u4F7F\u7528\u52A8\u6001\u4EE3\u7406\u6A21\u5F0F-\u9690\u85CF\u901A\u4FE1\u7EC6\u8282" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u52A8\u6001\u4EE3\u7406\u6A21\u5F0F-\u9690\u85CF\u901A\u4FE1\u7EC6\u8282" aria-hidden="true">#</a> <strong>| \u4F7F\u7528\u52A8\u6001\u4EE3\u7406\u6A21\u5F0F\uFF0C\u9690\u85CF\u901A\u4FE1\u7EC6\u8282</strong></h4><p>xxl-job \u5B9A\u4E49\u4E86\u4E24\u4E2A\u63A5\u53E3 ExecutorBiz\uFF0CAdminBiz\uFF0CExecutorBiz \u63A5\u53E3\u4E2D\u5C01\u88C5\u4E86\u5411\u5FC3\u8DF3\uFF0C\u6682\u505C\uFF0C\u89E6\u53D1\u6267\u884C\u7B49\u64CD\u4F5C\uFF0CAdminBiz \u5C01\u88C5\u4E86\u56DE\u8C03\uFF0C\u6CE8\u518C\uFF0C\u53D6\u6D88\u6CE8\u518C\u64CD\u4F5C\uFF0C\u63A5\u53E3\u7684\u5B9E\u73B0\u7C7B\u4E2D\uFF0C\u5E76\u6CA1\u6709\u901A\u4FE1\u76F8\u5173\u7684\u5904\u7406\u3002</p><p>XxlRpcReferenceBean \u7C7B\u7684 getObject() \u65B9\u6CD5\u4F1A\u751F\u6210\u4E00\u4E2A\u4EE3\u7406\u7C7B\uFF0C\u8FD9\u4E2A\u4EE3\u7406\u7C7B\u4F1A\u8FDB\u884C\u8FDC\u7A0B\u901A\u4FE1\u3002</p><h4 id="\u5168\u5F02\u6B65\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#\u5168\u5F02\u6B65\u5904\u7406" aria-hidden="true">#</a> <strong>| \u5168\u5F02\u6B65\u5904\u7406</strong></h4><p>\u6267\u884C\u5668\u6536\u5230\u6D88\u606F\u8FDB\u884C\u53CD\u5E8F\u5217\u5316\uFF0C\u5E76\u6CA1\u6709\u540C\u6B65\u6267\u884C\u4EFB\u52A1\u4EE3\u7801\uFF0C\u800C\u662F\u5C06\u4EFB\u52A1\u4FE1\u606F\u5B58\u50A8\u5728\xA0LinkedBlockingQueue \u4E2D\uFF0C\u5F02\u6B65\u7EBF\u7A0B\u4ECE\u8FD9\u4E2A\u961F\u5217\u4E2D\u83B7\u53D6\u4EFB\u52A1\u4FE1\u606F\uFF0C\u7136\u540E\u6267\u884C\u3002</p><p>\u800C\u4EFB\u52A1\u7684\u5904\u7406\u7ED3\u679C\uFF0C\u4E5F\u4E0D\u662F\u8BF4\u5904\u7406\u5B8C\u4E4B\u540E\uFF0C\u540C\u6B65\u8FD4\u56DE\u7684\uFF0C\u4E5F\u662F\u653E\u5230\u56DE\u8C03\u7EBF\u7A0B\u7684\u963B\u585E\u961F\u5217\u4E2D\uFF0C\u5F02\u6B65\u7684\u5C06\u5904\u7406\u7ED3\u679C\u8FD4\u56DE\u56DE\u53BB\u3002</p><p>\u8FD9\u6837\u5904\u7406\u7684\u597D\u5904\u5C31\u662F\u51CF\u5C11\u4E86 netty \u5DE5\u4F5C\u7EBF\u7A0B\u7684\u5904\u7406\u65F6\u95F4\uFF0C\u63D0\u5347\u4E86\u541E\u5410\u91CF\u3002</p><h4 id="\u5BF9\u5F02\u6B65\u5904\u7406\u7684\u5305\u88C5" tabindex="-1"><a class="header-anchor" href="#\u5BF9\u5F02\u6B65\u5904\u7406\u7684\u5305\u88C5" aria-hidden="true">#</a> <strong>| \u5BF9\u5F02\u6B65\u5904\u7406\u7684\u5305\u88C5</strong></h4><p>\u5BF9\u5F02\u6B65\u5904\u7406\u8FDB\u884C\u4E86\u5305\u88C5\uFF0C\u4EE3\u7801\u770B\u8D77\u6765\u662F\u540C\u6B65\u8C03\u7528\u7684\u3002</p><p>\u6211\u4EEC\u770B\u4E0B\u8C03\u5EA6\u5668\uFF0CXxlJobTrigger \u7C7B\u89E6\u53D1\u4EFB\u52A1\u6267\u884C\u7684\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public static ReturnT&lt;String&gt; runExecutor(TriggerParam triggerParam, String address){
    ReturnT&lt;String&gt; runResult = null;
    try {
        ExecutorBiz executorBiz = XxlJobScheduler.getExecutorBiz(address);
        //\u8FD9\u91CC\u9762\u505A\u4E86\u5F88\u591A\u5F02\u6B65\u5904\u7406\uFF0C\u6700\u7EC8\u540C\u6B65\u5F97\u5230\u5904\u7406\u7ED3\u679C
        runResult = executorBiz.run(triggerParam);
    } catch (Exception e) {
        logger.error(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job trigger error, please check if the executor[{}] is running.&quot;, address, e);
        runResult = new ReturnT&lt;String&gt;(ReturnT.FAIL_CODE, ThrowableUtil.toString(e));
    }

    StringBuffer runResultSB = new StringBuffer(I18nUtil.getString(&quot;jobconf_trigger_run&quot;) + &quot;\uFF1A&quot;);
    runResultSB.append(&quot;&lt;br&gt;address\uFF1A&quot;).append(address);
    runResultSB.append(&quot;&lt;br&gt;code\uFF1A&quot;).append(runResult.getCode());
    runResultSB.append(&quot;&lt;br&gt;msg\uFF1A&quot;).append(runResult.getMsg());

    runResult.setMsg(runResultSB.toString());
    return runResult;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ExecutorBiz.run \u65B9\u6CD5\u6211\u4EEC\u8BF4\u8FC7\u4E86\uFF0C\u662F\u8D70\u7684\u52A8\u6001\u4EE3\u7406\uFF0C\u548C\u6267\u884C\u5668\u8FDB\u884C\u901A\u4FE1\uFF0C\u6267\u884C\u5668\u6267\u884C\u7ED3\u679C\u4E5F\u662F\u5F02\u6B65\u5904\u7406\u5B8C\uFF0C\u624D\u8FD4\u56DE\u7684\uFF0C\u800C\u8FD9\u91CC\u770B\u5230\u7684 run \u65B9\u6CD5\u662F\u540C\u6B65\u7B49\u5F85\u5904\u7406\u7ED3\u679C\u8FD4\u56DE\u3002</p><p>\u6211\u4EEC\u770B\u4E0Bxxl-job\u662F\u5982\u4F55\u540C\u6B65\u83B7\u53D6\u5904\u7406\u7ED3\u679C\u7684\uFF1A\u8C03\u5EA6\u5668\u5411\u6267\u884C\u5668\u53D1\u51FA\u6D88\u606F\u540E\uFF0C\u8BE5\u7EBF\u7A0B\u963B\u585E\u3002\u7B49\u5230\u6267\u884C\u5668\u5904\u7406\u5B8C\u6BD5\u540E\uFF0C\u5C06\u5904\u7406\u7ED3\u679C\u8FD4\u56DE\uFF0C\u5524\u9192\u88AB\u963B\u585E\u7684\u7EBF\u7A0B\uFF0C\u8C03\u7528\u5904\u62FF\u5230\u8FD4\u56DE\u503C\u3002</p><p>\u52A8\u6001\u4EE3\u7406\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//\u4EE3\u7406\u7C7B\u4E2D\u7684\u89E6\u53D1\u8C03\u7528
if (CallType.SYNC == callType) {
   // future-response set
   XxlRpcFutureResponse futureResponse = new XxlRpcFutureResponse(invokerFactory, xxlRpcRequest, null);
   try {
      // do invoke
      client.asyncSend(finalAddress, xxlRpcRequest);

      // future get
      XxlRpcResponse xxlRpcResponse = futureResponse.get(timeout, TimeUnit.MILLISECONDS);
      if (xxlRpcResponse.getErrorMsg() != null) {
         throw new XxlRpcException(xxlRpcResponse.getErrorMsg());
      }
      return xxlRpcResponse.getResult();
   } catch (Exception e) {
      logger.info(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-rpc, invoke error, address:{}, XxlRpcRequest{}&quot;, finalAddress, xxlRpcRequest);

      throw (e instanceof XxlRpcException)?e:new XxlRpcException(e);
   } finally{
      // future-response remove
      futureResponse.removeInvokerFuture();
   }
} 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>XxlRpcFutureResponse \u7C7B\u4E2D\u5B9E\u73B0\u4E86\u7EBF\u7A0B\u7684\u7B49\u5F85\uFF0C\u548C\u7EBF\u7A0B\u5524\u9192\u7684\u5904\u7406\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//\u8FD4\u56DE\u7ED3\u679C\uFF0C\u5524\u9192\u7EBF\u7A0B
public void setResponse(XxlRpcResponse response) {
   this.response = response;
   synchronized (lock) {
      done = true;
      lock.notifyAll();
   }
}

@Override
    public XxlRpcResponse get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException {
        if (!done) {
            synchronized (lock) {
                try {
                    if (timeout &lt; 0) {
            //\u7EBF\u7A0B\u963B\u585E
                        lock.wait();
                    } else {
                        long timeoutMillis = (TimeUnit.MILLISECONDS==unit)?timeout:TimeUnit.MILLISECONDS.convert(timeout , unit);
                        lock.wait(timeoutMillis);
                    }
                } catch (InterruptedException e) {
                    throw e;
                }
            }
        }

        if (!done) {
            throw new XxlRpcException(&quot;xxl-rpc, request timeout at:&quot;+ System.currentTimeMillis() +&quot;, request:&quot; + request.toString());
        }
        return response;
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6709\u7684\u540C\u5B66\u53EF\u80FD\u4F1A\u95EE\u4E86\uFF0C\u8C03\u5EA6\u5668\u63A5\u6536\u5230\u8FD4\u56DE\u7ED3\u679C\uFF0C\u600E\u4E48\u786E\u5B9A\u5524\u9192\u54EA\u4E2A\u7EBF\u7A0B\u5462\uFF1F</p><p>\u6BCF\u4E00\u6B21\u8FDC\u7A0B\u8C03\u7528\uFF0C\u90FD\u4F1A\u751F\u6210 uuid \u7684\u8BF7\u6C42 id\uFF0C\u8FD9\u4E2A id \u662F\u5728\u6574\u4E2A\u8C03\u7528\u8FC7\u7A0B\u4E2D\u4E00\u76F4\u4F20\u9012\u7684\uFF0C\u5C31\u50CF\u4E00\u628A\u94A5\u5319\uFF0C\u5728\u4F60\u56DE\u5BB6\u7684\u7684\u65F6\u5019\uFF0C\u62FF\u7740\u5B83\u5C31\u5E26\u5F00\u95E8\u3002</p><p>\u8FD9\u91CC\u62FF\u7740\u8BF7\u6C42 id \u8FD9\u628A\u94A5\u5319\uFF0C\u5C31\u80FD\u627E\u5230\u5BF9\u5E94\u7684 XxlRpcFutureResponse\uFF0C\u7136\u540E\u8C03\u7528 setResponse \u65B9\u6CD5\uFF0C\u8BBE\u7F6E\u8FD4\u56DE\u503C\uFF0C\u5524\u9192\u7EBF\u7A0B\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public void notifyInvokerFuture(String requestId, final XxlRpcResponse xxlRpcResponse){

    // \u901A\u8FC7requestId\u627E\u5230XxlRpcFutureResponse\uFF0C
    final XxlRpcFutureResponse futureResponse = futureResponsePool.get(requestId);
    if (futureResponse == null) {
        return;
    }
    if (futureResponse.getInvokeCallback()!=null) {

        // callback type
        try {
            executeResponseCallback(new Runnable() {
                @Override
                public void run() {
                    if (xxlRpcResponse.getErrorMsg() != null) {
                        futureResponse.getInvokeCallback().onFailure(new XxlRpcException(xxlRpcResponse.getErrorMsg()));
                    } else {
                        futureResponse.getInvokeCallback().onSuccess(xxlRpcResponse.getResult());
                    }
                }
            });
        }catch (Exception e) {
            logger.error(e.getMessage(), e);
        }
    } else {
        // \u91CC\u9762\u8C03\u7528lock\u7684notify\u65B9\u6CD5
        futureResponse.setResponse(xxlRpcResponse);
    }

    // do remove
    futureResponsePool.remove(requestId);

}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code> \\-------------\xA0 END\xA0\xA0-------------
</code></pre><p><strong>\u6B64\u5916\uFF0C\u6211\u7684\u6240\u6709\u6587\u7AE0\u5DF2\u7ECF\u5F00\u6E90\u4E86\u3002\u66F4\u591A\u7CBE\u5F69\u5185\u5BB9\u6536\u5F55\u5728\u6211\u7684GitHub\uFF0C\u8BBF\u95EE\u5730\u5740\uFF1A<strong><strong>https://github.com/dvsusan/susanSayJava</strong></strong>\uFF0C\u6B22\u8FCE\u5C0F\u4F19\u4F34\u4EEC\u7ED9\u6211\u4E00\u4E2A<strong><strong>star</strong></strong>\u3002</strong></p><p><strong>\u70B9\u51FB</strong>\u{1F447}\u{1F3FB}<strong>\u9605\u8BFB\u539F\u6587\uFF0C\u76F4\u63A5\u53EF\u8BBF\u95EE\u8BE5github</strong></p>`,37),t=[r];function d(u,c){return n(),i("div",null,t)}var o=e(l,[["render",d],["__file","xxljobjydsjznjrba.html.vue"]]);export{o as default};
